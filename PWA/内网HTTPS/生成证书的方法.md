
# 只要安装了git客户端就会有openssl

# 操作如下

1. 生成私钥key文件
    `openssl genrsa -out privatekey.pem 1024`

2. 通过私钥生成CSR证书签名  （需要填一些信息、可直接回车）
    `openssl req -new -key privatekey.pem -out certrequest.csr`

3. 通过私钥和证书签名生成证书文件
    `openssl x509 -req -in certrequest.csr -signkey privatekey.pem -out certificate.pem`

# 执行完第三条命令会看到

`Signature ok`

表示生成成功，最终看到如下三个文件

  1. privatekey.pem: 私钥
  2. certrequest.csr: CSR证书签名
  3. certificate.pem: 证书文件

# 注意

可能会因为证书不正规，导致浏览器提示安全问题。点击继续访问即可。
10.108.143.66:3011




# 软件需求：

1. [OpenSSL](https://www.openssl.org/)，建议[下载安装包](http://slproweb.com/products/Win32OpenSSL.html)，安装了 git 也可以
2. 已经安装了Java Jdk环境
3. 注意环境变量的配置

# 制作CA根证书

现在开始生成CA证书

创建私钥：genrsa -out ca-key.pem 1024

创建证书请求：req -new -out ca-req.csr -key ca-key.pem -config openssl.cnf





1. 在目标文件夹下打开 shell 。

生成CA证书

2. 生成私钥命令： `openssl genrsa -out ca-key.pem 1024`

3. 创建证书请求： `openssl req -new -out ca-req.csr -key ca-key.pem`

4. 生成CA自签证书(10年有效期)： `openssl x509 -req -in ca-req.csr -out ca-cert.pem -signkey ca-key.pem -days 3650`

生成server证书

5. 创建私钥: openssl genrsa -out server-key.pem 1024

6. 创建证书请求： openssl req -new -out server-req.csr -key server-key.pem

7. 自签署证书： openssl x509 -req -in server-req.csr -out server-cert.pem -signkey server-key.pem -CA ca-cert.pem -CAkey ca-key.pem -CAcreateserial -days 3650


生成client证书，与服务器生成证书差不多

创建私钥： openssl genrsa -out client-key.pem 1024

创建证书请求： openssl req -new -out client-req.csr -key client-key.pem

自签署证书： openssl x509 -req -in client-req.csr -out client-cert.pem -signkey client-key.pem -CA ca-cert.pem -CAkey ca-key.pem -CAcreateserial -days 3650



转化成p12格式： openssl pkcs12 -export -in client-cert.pem -out client-cert.p12

               openssl pkcs12 -export -in client-cert.pem -inkey client-key.pem -out client-cert.p12


openssl pkcs12 -export -clcerts -in ca-cert.pem -inkey ca-key.pem -out ca.p12



本地HTTPS

下面介绍主要围绕 [mkcert](https://github.com/FiloSottile/mkcert) 库的使用，只介绍了 window 下的安装使用，其他系统请看它的 GitHub 说明。此方法仅用于本地开发，不能用于生产。

1. window 安装 choco (管理员shell运行)： `Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))`

2. window 安装 mkcert ： `choco install mkcert`

3. 将 CA 证书加入本地可信 CA ： `mkcert -install`

4. 生成自签证书(改为自己的本地IP)： `mkcert 10.108.143.66`
    - 注意，这里会生成两个文件： `10.108.143.66.pem` 和 `10.108.143.66-key.pem` 。

5. 获取根 CA 证书的存放路径： `mkcert -CAROOT`

6. 把 rootCA.pem 拷贝一个副本，并命名为 rootCA.crt (因为windows并不识别pem扩展名，并且Ubuntu也不会将pem扩展名作为CA证书文件对待)，将 rootCA.crt 文件分发给其他用户，手工导入。
        - window 和 macOS ： 双击执行 rootCA.crt ，按指引把证书存放在 **"受信任的根证书颁发机构"** 。
        - Ubuntu ： 将 rootCA.crt 放入 `/usr/local/share/ca-certificates/` ，然后执行 `sudo update-ca-certificates`
        - 安卓 和 IOS ： 把 rootCA.crt 放到手机中，点击该文件安装即可 (不同手机的情况可能不一样,可能需要去"设置"中添加CA证书)

7. 创建服务 Node 的 HTTPS 服务： 

    ``` js
    const opt = {
        key: fs.readFileSync('./ssl/10.108.143.66-key.pem'),
        cert: fs.readFileSync('./ssl/10.108.143.66.pem')
    }
    https.createServer(opt, requestListener)
    ```
